<div th:fragment="navbar">
  <nav class="navbar navbar-expand-lg nav-bg-color sticky-top shadow-sm p-0">
    <div class="container-fluid" style="flex-wrap: initial;">
      <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample" style="color: white; border-color:white;">
        <i class="fa-solid fa-bars"></i>
      </button>
      <a class="navbar-brand ms-3" th:href="@{/admin}"><img
              src="/images/brand2.png" height="50"></a>

      <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
        <div class="offcanvas-header border-bottom">
          <div class="offcanvas-title" id="offcanvasExampleLabel">
            <img src="/images/brand2.png" height="50"></div>
          <div data-bs-theme="dark">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>

        </div>
        <div class="offcanvas-body px-5">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link btn btn-nav-item text-white text-start px-3" th:href="@{/admin}" id="navHome">
                <i class="fa-solid fa-house me-1" style="width:20px; text-align:center;"></i>Tổng quan</a>
            </li>
            <li class="nav-item">
              <a class="nav-link btn btn-nav-item text-white text-start px-3" aria-current="page" th:href="@{/admin/product}" id="navProduct">
                <i class="bi bi-box-seam-fill me-2" style="width:20px;text-align:center;"></i> Hàng hoá</a>
            </li>
            <li class="nav-item">
              <a class="nav-link btn btn-nav-item text-white text-start px-3" th:href="@{/admin/invoice}" id="navInvoice">
                <i class="fa-solid fa-file-invoice me-2" style="width:18px;text-align:center;"></i>Đơn hàng</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle btn btn-nav-item text-white text-start px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" id="navPerson">
                <i class="fa-solid fa-handshake-angle me-2"></i>Đối tác
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" th:href="@{/admin/customer}"><i class="bi bi-person me-2"></i>Khách hàng</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" th:href="@{/admin/supplier}"><i class="bi bi-people me-2"></i>Nhà cung cấp</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link btn btn-nav-item text-white text-start px-3" th:href="@{/admin/PurchaseOrder}" id="navImport"><i class="fa-solid fa-cart-flatbed me-2"></i>Nhập hàng</a>
            </li>
            <li class="nav-item">
              <a class="nav-link btn btn-nav-item text-white text-start px-3" th:href="@{/admin/account}" id="navUser"><i class="fa-solid fa-address-book me-2"></i> Quản lý người dùng</a>
            </li>
            <li class="nav-item">
              <a class="nav-link btn btn-nav-item text-white text-start px-3" href="#" id="navChart"><i class="bi bi-bar-chart-line-fill me-2"></i> Thống kê</a>
            </li>
          </ul>

        </div>

      </div>
      <a class="btn btn-cart me-2" id="sell" th:href="@{/admin/invoice/sell}" style="margin: 12px 0px;"><i class="bi bi-bag-heart-fill me-2"></i>BÁN HÀNG</a>
      <div class="nav-item dropdown">
        <button class="btn btn-nav-item text-white dropdown-toggle" type="button" data-bs-toggle="dropdown"
                aria-expanded="false">
          <span><i class="fa-solid fa-circle-user me-2"></i>Hi, <span th:text="${#strings.setSplit(loggedInUser.name, ' ')[#strings.setSplit(loggedInUser.name, ' ').size() - 1]}"></span></span>

        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item showBtn" th:href="@{/admin/account/findUserID(userID=${loggedInUser.id})}"><i class="fa-regular fa-address-card me-2"></i> Thông tin tài
            khoản</a>
          </li>
          <li><button class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#changePassword"><i class="bi bi-person-lock me-2"></i> Đổi mật khẩu</button>
          </li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><button class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#sign-outModal"><i class="fa-solid fa-arrow-right-from-bracket me-2"></i> Đăng
            xuất</button></li>
        </ul>
      </div>
    </div>


  </nav>
  <div class="modal fade" id="showUserModal" tabindex="-1" aria-labelledby="showUserLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header" style="background-color: rgba(161, 58, 58, 0.2);">
          <div class="modal-title" id="showUserLabel">
            <ul class="nav nav-pills" id="myTab" role="tablist">
              <li class="nav-item me-2" role="presentation">
                <button class="btn btn-tab active" id="info-tab" data-bs-toggle="tab" data-bs-target="#info-tab-pane" type="button" role="tab" aria-controls="info-tab-pane" aria-selected="true">Thông tin</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="btn btn-tab" id="history-tab" data-bs-toggle="tab" data-bs-target="#history-tab-pane" type="button" role="tab" aria-controls="history-tab-pane" aria-selected="false">Phân quyền</button>
              </li>
            </ul>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body px-5">
          <div class="tab-content" style="min-height: 350px;" id="myTabContent">
            <div class="tab-pane fade show active" id="info-tab-pane" role="tabpanel" aria-labelledby="info-tab" tabindex="0">
              <div class="mb-3 row border-bottom">
                <div class="col-sm-4 ps-0">
                  <p class="m-0">Tên người dùng:</p>
                </div>
                <div class="col-sm-8 ps-0">
                  <p class="m-0" id="getUserName" name="name"></p>
                </div>
              </div>
              <div class="mb-3 row border-bottom">
                <div class="col-sm-4 ps-0">
                  <p class="m-0">Số điện thoại:</p>
                </div>
                <div class="col-sm-8 ps-0">
                  <p class="m-0" id="getUserPhone" name="phone"></p>
                </div>
              </div>
              <div class="mb-3 row border-bottom">
                <div class="col-sm-4 ps-0">
                  <p class="m-0">Email:</p>
                </div>
                <div class="col-sm-8 ps-0">
                  <p class="m-0" id="getUserEmail" name="email"></p>
                </div>
              </div>
              <div class="mb-3 row border-bottom">
                <div class="col-sm-4 ps-0">
                  <p class="m-0">Địa chỉ:</p>
                </div>
                <div class="col-sm-8 ps-0">
                  <p class="m-0" id="getUserAddress" name="address"></p>
                </div>
              </div>

            </div>
            <div class="tab-pane fade" id="history-tab-pane" role="tabpanel" aria-labelledby="history-tab" tabindex="0">
              <p>Phân quyền...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="changePassword" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="changePasswordLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form th:action="@{'/admin/account/changePw/'+${loggedInUser.id}}" method="post">
      <div class="modal-content">
        <div class="modal-header" style="background-color: rgba(161, 58, 58, 0.5);">
          <h1 class="modal-title fs-6 fw-normal text-white" id="changePasswordLabel">Đổi mật khẩu</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3 row">
            <label for="inputUserPw1" class="col-sm-4 col-form-label">Mật khẩu <span class="text-danger">*</span></label>
            <div class="col-sm-8">
              <div class="input-group">
                <input type="password" class="form-control border-end-0" id="inputUserPw1" name="changePw" value="" required onchange="enterNewPw()">
                <span class="input-group-text border-start-0 bg-white">
                  <button type="button" class="border-0 bg-white" onclick="showPassword1()"><i id="pwEye1" class="bi bi-eye-slash"></i></button>
              </span>
              </div>
              <small id="passwordCondition1" class="form-text text-danger">Mật khẩu có độ dài từ 6 - 15 kí tự (bao gồm chữ thường, chữ in hoa và chữ số)</small>
            </div>
          </div>
          <div class="row">
            <label for="inputUserRePw1" class="col-sm-4 col-form-label">Nhập lại mật khẩu <span
                    class="text-danger">*</span></label>
            <div class="col-sm-8">
              <div class="input-group">
                <input type="password" class="form-control border-end-0" name="RePassword1" id="inputUserRePw1" value="" required onchange="enterNewPw()">
                <span class="input-group-text border-start-0 bg-white">
                                        <button type="button" class="border-0 bg-white" onclick="showRePassword1()"><i id="rePwEye1" class="bi bi-eye-slash"></i></button>
                                    </span>
              </div>
              <small id="passwordMatchMessage1" class="form-text text-danger" style="display:none;">Mật khẩu không trùng khớp.</small>
            </div>
          </div>
        </div>
        <div class="modal-footer border-0 pt-0">
          <button type="submit" class="btn btn-success btn-sm" id="saveNewPw1" disabled><i class="bi bi-floppy-fill me-2"></i>Lưu</button>
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal"><i
                  class="bi bi-x-circle me-2"></i>Đóng
          </button>
        </div>
      </div>
      </form>
    </div>
  </div>
  <div class="modal fade" id="sign-outModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="sign-outLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header" style="background-color: rgba(161, 58, 58, 0.5);">
          <p class="modal-title fs-6 fw-normal text-white" id="sign-outLabel">Xác nhận đăng xuất</p>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="m-0">Bạn chắc chắn muốn đăng xuất khỏi hệ thống?</p>
        </div>
        <div class="modal-footer border-0 pt-0">
          <a href="/signout" class="btn btn-danger btn-sm"><i class="bi bi-check-circle me-2"></i>Đồng ý</a>
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal"><i class="bi bi-x-circle me-2"></i>Đóng</button>
        </div>
      </div>
    </div>
  </div>
  <script>
  $(document).ready(function () {
    $('.showBtn').on('click', function (event) {
      event.preventDefault();
      const href = $(this).attr('href');
      $.get(href, function (user) {
        $('#getUserName').text(user.name);
        $('#getUserPhone').text(user.phone);
        $('#getUserAddress').text(user.address);
        $('#getUserEmail').text(user.email);
      });

      $('#showUserModal').modal('show');
    });
  });
</script>
  <script>
    function enterNewPw(){
      const password1 = $('#inputUserPw1').val().trim();
      const passwordRepeat1 = $('#inputUserRePw1').val().trim();
      const regex1 = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{6,15}$/;

      if (password1.trim() === ""){
        $('#inputUserPw1').val('');
        $('#passwordCondition1').css('display', 'block');
      } else {
        if (regex1.test(password1.trim())){
          $('#passwordCondition1').css('display', 'none');
        } else {
          $('#passwordCondition1').css('display', 'block');
        }
        $('#inputUserPw1').val(password1.trim());
      }

      if (password1 !== passwordRepeat1) {
        $('#passwordMatchMessage1').css('display', 'block'); // Hiển thị thông báo khi mật khẩu không trùng khớp
        document.getElementById('saveNewPw1').disabled = true;
      } else {
        $('#passwordMatchMessage1').css('display', 'none'); // Ẩn thông báo khi mật khẩu trùng khớp hoặc chưa nhập mật khẩu
        document.getElementById('saveNewPw1').disabled = false;
      }
    }

    function showPassword1() {
      var passwordInput1 = document.getElementById("inputUserPw1");

      if (passwordInput1.type === "password") {
        document.getElementById('pwEye1').classList.replace('bi-eye-slash','bi-eye')
        passwordInput1.type = "text";
      } else {
        document.getElementById('pwEye1').classList.replace('bi-eye','bi-eye-slash')
        passwordInput1.type = "password";
      }
    }

    function showRePassword1() {
      var rePasswordInput1 = document.getElementById("inputUserRePw1");

      if (rePasswordInput1.type === "password") {
        document.getElementById('rePwEye1').classList.replace('bi-eye-slash','bi-eye')
        rePasswordInput1.type = "text";
      } else {
        document.getElementById('rePwEye1').classList.replace('bi-eye','bi-eye-slash')
        rePasswordInput1.type = "password";
      }
    }
  </script>
</div>
